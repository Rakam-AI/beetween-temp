# T2.13 - Implement Request REST Controller


**Depends on:** T2.6, T2.7, T2.8, T2.9, T2.10, T2.11, T1.6, T1.8
**Blocks:** T2.17, T2.20

**Context:**
The Request controller exposes REST endpoints for the full request lifecycle.

Reference: `API_Technical Specification V1.md` > "Endpoints principaux > Gestion des demandes de recrutement"

**Objective:**
Create the REST controller with all request endpoints.

**Instructions:**

1. **Create DTOs in `adapter/input/web/request/dto/`:**
   - **`RequestInputDto.kt`**: For creation/update (without server-generated fields)
     - title, workflowId, businessInfo (BusinessInfoDto), additionalFieldValues (Map)
   - **`RequestOutputDto.kt`**: Full response including id, status, currentStepIndex, history, etc.
   - **`BusinessInfoDto.kt`** and all sub-DTOs mirroring the domain objects
   - **`HistoryEntryDto.kt`**
   - **`CommentInputDto.kt`**: { comment: String }
   - **`RejectionInputDto.kt`**: { reason: String }
   - **`RequestListItemDto.kt`**: Lighter DTO for list views (no full history, no full business data)

2. **Create mapper functions** between DTOs and domain models

3. **Create `adapter/input/web/request/RequestController.kt`:**
   ```kotlin
   @RestController
   @RequestMapping("/api/v1/requests")
   class RequestController(
       private val createRequest: CreateRequestUseCase,
       private val updateRequest: UpdateRequestUseCase,
       private val getRequest: GetRequestByIdUseCase,
       private val listRequests: ListRequestsUseCase,
       private val submitRequest: SubmitRequestUseCase,
       private val approveRequest: ApproveRequestUseCase,
       private val rejectRequest: RejectRequestUseCase,
       private val commentRequest: CommentRequestUseCase,
       private val archiveRequest: ArchiveRequestUseCase
   ) {
       @PostMapping
       fun create(...)

       @PutMapping("/{id}")
       fun update(...)

       @GetMapping
       fun list(... page, size, status, workflowId, createdBy, pendingValidatorId, sortBy, sortOrder ...)

       @GetMapping("/{id}")
       fun getById(...)

       @PostMapping("/{id}/submission")
       fun submit(...)

       @PostMapping("/{id}/comment")
       fun comment(...)

       @PostMapping("/{id}/approval")
       fun approve(...)

       @PostMapping("/{id}/rejection")
       fun reject(...)

       @PostMapping("/{id}/archive")
       fun archive(...)

       @PostMapping("/{id}/duplicate")
       fun duplicate(...)
   }
   ```

4. **Add OpenAPI annotations** on all endpoints

5. **Map domain errors to HTTP responses:**
   - `RequestNotFound` → 404
   - `CannotModifySubmittedRequest` → 400
   - `MissingRequiredFields` → 400 with field list
   - `UnauthorizedAction` → 403
   - `ConcurrentModification` → 409
   - `InvalidStatusTransition` → 400

**Acceptance Criteria:**
- All 10 endpoints match the API specification (including duplicate)
- Proper HTTP status codes
- Response wrapper format
- Full pagination on list endpoint with all filter parameters
- Domain errors properly mapped to HTTP responses
- OpenAPI documentation complete
