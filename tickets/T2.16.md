# T2.16 - Implement Pulsar Event Publisher


**Depends on:** T1.4, T2.7, T2.8, T2.9, T2.11
**Blocks:** T2.20

**Context:**
Events must be published to Apache Pulsar topics for downstream consumers (notification service, analytics, audit).

Reference: `API_Technical Specification V1.md` > "Gestion des événements - Apache Pulsar"

**Objective:**
Create the Pulsar adapter implementing the EventPublisherPort.

**Instructions:**

1. **Create `adapter/output/messaging/PulsarEventPublisher.kt`:**
   - Implements `EventPublisherPort`
   - Publishes to two topics:
     - `persistent://recruitment-app/{namespace}/requests` for RequestEvents
     - `persistent://recruitment-app/{namespace}/workflows` for WorkflowEvents
   - Serializes events using **Avro** schema (`Schema.AVRO(EventClass::class.java)`) as required by the API spec (NOT JSON)
   - Includes eventType, timestamp, and payload in the message
   - Uses async sending for non-blocking operation
   - Handles publish failures gracefully (log error, don't crash the main flow)

2. **Create event envelope structure:**
   ```kotlin
   data class PulsarEventEnvelope(
       val eventType: String,
       val timestamp: Instant,
       val payload: Any
   )
   ```

3. **Map domain events to Pulsar event types:**
   - `RequestCreated` → eventType: "RequestCreated"
   - `RequestSubmitted` → eventType: "RequestSubmitted"
   - etc. (matching the spec's event type names)

4. **Create the fallback `LoggingEventPublisher`:**
   - When Pulsar is disabled, log events to stdout in JSON format
   - Useful for development and testing

5. **Wire in `BeanConfig.kt`:**
   - If `pulsar.enabled=true` → use PulsarEventPublisher
   - Otherwise → use LoggingEventPublisher

**Acceptance Criteria:**
- Events published to correct Pulsar topics
- Event format matches specification (eventType, timestamp, payload)
- Async publishing (non-blocking)
- Graceful fallback to logging when Pulsar unavailable
- Events use **Avro** serialization as required by the API spec (not JSON)
- All event types from the spec are supported
