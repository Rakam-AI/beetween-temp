# T2.21 - Implement End-to-End Test Scenarios


**Depends on:** T2.20
**Blocks:** None (final quality gate)

**Context:**
E2E tests validate complete business scenarios as described in the specification.

Reference: `API_Technical Specification V1.md` > Contraintes techniques > "Scenarios E2E à couvrir"

**Objective:**
Create E2E tests covering the critical business scenarios.

**Instructions:**

Create the following test scenarios (each as a separate test method or class):

1. **Scenario: Full Workflow Lifecycle**
   - Admin creates workflow with 3 steps (ONE, ALL, ONE modes)
   - Admin publishes workflow
   - Verify workflow appears in list as PUBLISHED
   - Admin unpublishes workflow
   - Verify workflow still works for existing requests

2. **Scenario: Full Request Approval (Multi-Step)**
   - Admin creates and publishes a 3-step workflow
   - Recruiter creates a request with the workflow
   - Recruiter fills all fields and submits
   - Step 1 validator (mode ONE) approves → step 2
   - Step 2: first validator (mode ALL) approves → still pending
   - Step 2: second validator (mode ALL) approves → step 3
   - Step 3 validator (mode ONE) approves → APPROVED
   - Creator archives the approved request

3. **Scenario: Request Rejection and Duplication**
   - Create and submit a request
   - Validator rejects with reason
   - Creator duplicates the rejected request
   - Verify duplicate has same data but DRAFT status
   - Creator modifies and resubmits

4. **Scenario: Draft Abandonment**
   - Creator creates a request (DRAFT)
   - Creator archives (abandons) the draft
   - Verify status is ABANDONED
   - Verify request no longer appears in active lists

5. **Scenario: Access Control**
   - User A (company 1) creates a workflow
   - User B (company 2) cannot see it
   - User A creates a request
   - Validator from company 2 cannot approve it
   - Correct validator approves successfully

**Acceptance Criteria:**
- All 5 scenarios pass
- Each scenario tests the complete flow end-to-end
- Tests are self-contained (set up their own data)
- Tests clean up after themselves
- Tests serve as living documentation of the business rules
