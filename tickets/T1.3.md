# T1.3 - Add MongoDB Dependency & Configuration


**Depends on:** T1.1
**Blocks:** T2.14, T2.15

**Context:**
The specification requires MongoDB as the document database. The base template has no persistence layer (it used NoOp adapters). We need to add Spring Data MongoDB and configure it for local development via Docker.

Reference: `API_Technical Specification V1.md` > Architecture technique > "Stockage des donn√©es dans une base documentaire (MongoDB)"

**Objective:**
Add MongoDB as the persistence layer with proper Spring Boot configuration and Docker support.

**Instructions:**
1. **In `pom.xml`, add dependencies:**
   ```xml
   <dependency>
       <groupId>org.springframework.boot</groupId>
       <artifactId>spring-boot-starter-data-mongodb</artifactId>
   </dependency>
   ```
   Also add for testing:
   ```xml
   <dependency>
       <groupId>org.testcontainers</groupId>
       <artifactId>mongodb</artifactId>
       <scope>test</scope>
   </dependency>
   ```

2. **In `application.yml`, add MongoDB config:**
   ```yaml
   spring:
     data:
       mongodb:
         uri: mongodb://localhost:27017/dar
         database: dar
   ```

3. **In `docker-compose.yml`, add MongoDB service:**
   ```yaml
   mongodb:
     image: mongo:7.0
     container_name: dar-mongodb
     ports:
       - "27017:27017"
     volumes:
       - mongodb_data:/data/db
     environment:
       MONGO_INITDB_DATABASE: dar
   ```
   Add the `mongodb_data` volume at the bottom.

4. **Create `infra/config/DatabaseConfig.kt`** (or equivalent path following the existing config pattern):
   - Add `@Configuration` class
   - Enable MongoDB auditing with `@EnableMongoAuditing` for automatic `createdAt`/`updatedAt` handling
   - Add any necessary index configuration

5. **In `application-test.yaml`, add test MongoDB config:**
   - Use TestContainers dynamic URI (the IntegrationTestBase should set this up)

6. **Update `IntegrationTestBase.kt`:**
   - Add MongoDB TestContainer alongside Keycloak
   - Configure dynamic MongoDB URI for tests

**Acceptance Criteria:**
- `./mvnw clean compile` succeeds
- `docker compose up mongodb` starts a MongoDB instance on port 27017
- Application can start and connect to MongoDB when Docker is running
- Test configuration uses TestContainers for MongoDB
