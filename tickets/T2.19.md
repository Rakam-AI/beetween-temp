# T2.19 - Implement Use Case Unit Tests


**Depends on:** T2.5, T2.6, T2.7, T2.8, T2.9, T2.10, T2.11
**Blocks:** None (quality gate)

**Context:**
Each use case must be tested with mocked ports.

**Objective:**
Achieve > 80% test coverage on application layer.

**Instructions:**

For each use case, test:

1. **Success path** with valid inputs and authorized user
2. **Authorization failures** (wrong role, wrong company)
3. **Not found errors** (invalid IDs)
4. **Business rule violations** (invalid status transitions, missing fields)
5. **Concurrency handling** (optimistic locking failures)

Use **MockK** for mocking ports (repositories, event publishers).

Specific test scenarios:
- CreateWorkflow: admin creates → success, non-admin creates → 403
- UpdateWorkflow: update DRAFT → success, update PUBLISHED → error
- DeleteWorkflow: delete DRAFT with no requests → success, delete PUBLISHED → error
- CreateRequest: with published workflow → success, with unpublished → error
- SubmitRequest: all fields filled → success, missing fields → error with field list
- ApproveRequest: mode ONE → step advances, mode ALL partial → stays
- RejectRequest: with reason → success, without → error
- ArchiveRequest: DRAFT by creator → abandoned, APPROVED by admin → archived

**Acceptance Criteria:**
- > 80% line coverage on application layer
- All use cases tested
- Port interactions verified with MockK's `verify`
- Events verified as published when expected
