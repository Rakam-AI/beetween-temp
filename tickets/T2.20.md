# T2.20 - Implement Integration Tests


**Depends on:** T2.12, T2.13, T2.14, T2.15, T2.17
**Blocks:** T2.21

**Context:**
Integration tests verify the full stack from REST endpoint through use case to MongoDB, using TestContainers.

**Objective:**
Create integration tests for all major endpoints.

**Instructions:**

1. **Update `IntegrationTestBase.kt`:**
   - Add MongoDB TestContainer
   - Add Keycloak TestContainer with DAR realm
   - Configure token generation for test requests
   - Helper methods to create authenticated requests as different roles

2. **Create `WorkflowIT.kt`:**
   - Create a workflow (POST) → verify in DB
   - Update a workflow (PUT) → verify changes
   - List workflows with pagination and filters
   - Get workflow by ID
   - Delete workflow
   - Publish/Unpublish workflow
   - Verify admin-only access

3. **Create `RequestIT.kt`:**
   - Create a request → verify DRAFT status
   - Update a request → verify changes and history
   - List requests with filters
   - Submit a request → verify PENDING status
   - Approve → verify step advancement
   - Reject → verify REJECTED status
   - Comment → verify history entry
   - Archive → verify final status

4. **Verify access control:**
   - Cross-company access denied
   - Non-admin cannot create workflows
   - Non-validator cannot approve

**Acceptance Criteria:**
- All major endpoints tested end-to-end with real DB
- TestContainers used for MongoDB and Keycloak
- Access control verified
- Proper HTTP status codes verified
- Response format verified (wrapper, pagination)
